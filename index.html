<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Pelajar Aduan</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    form { max-width: 500px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    input, textarea, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 4px; border: 1px solid #ccc; }
    button { background: #007BFF; color: #fff; font-weight: bold; cursor: pointer; border: none; }
    button:hover { background: #0056b3; }
    .aduan-list { max-width: 700px; margin: 30px auto; }
    .aduan-item { background: #fff; padding: 15px; border-radius: 6px; margin-bottom: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .status { font-weight: bold; color: green; }
    .nota { font-style: italic; color: #555; }
  </style>
</head>
<body>
  <h1>PORTAL PELAJAR - HANTAR & SEMAK ADUAN</h1>

  <!-- Borang Hantar Aduan -->
  <form id="aduanForm">
    <input type="text" id="nama" placeholder="Nama Penuh" required>
    <input type="text" id="kelas" placeholder="Kelas" required>
    <textarea id="aduan" placeholder="Tulis aduan anda..." required></textarea>
    <button type="submit">Hantar Aduan</button>
  </form>

  <!-- Senarai Aduan Pelajar -->
  <div id="aduanList" class="aduan-list"></div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    // ✅ Config Firebase projek awak
    const firebaseConfig = {
      apiKey: "AIzaSyCkStR_IPVoyw83P9M3Xm0QayvNmHwsjz0",
      authDomain: "aduan-semsira.firebaseapp.com",
      projectId: "aduan-semsira",
      storageBucket: "aduan-semsira.firebasestorage.app",
      messagingSenderId: "900897970331",
      appId: "1:900897970331:web:5bea8305599c97a0e30e3e"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const aduanForm = document.getElementById("aduanForm");
    const aduanList = document.getElementById("aduanList");

    // Hantar aduan baru
    aduanForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nama = document.getElementById("nama").value.trim();
      const kelas = document.getElementById("kelas").value.trim();
      const aduan = document.getElementById("aduan").value.trim();

      try {
        await addDoc(collection(db, "aduan"), {
          nama, kelas, aduan,
          status: "Dalam Semakan",
          nota: "",
          tarikh: new Date()
        });
        alert("✅ Aduan berjaya dihantar!");
        aduanForm.reset();
      } catch (err) {
        alert("❌ Ralat: " + err.message);
      }
    });

    // Papar hanya aduan pelajar ikut nama + kelas
    function loadAduanPelajar(nama, kelas) {
      const q = query(
        collection(db, "aduan"),
        where("nama", "==", nama),
        where("kelas", "==", kelas),
        orderBy("tarikh", "desc")
      );

      onSnapshot(q, (snapshot) => {
        aduanList.innerHTML = "<h2>Senarai Aduan Anda</h2>";
        if (snapshot.empty) {
          aduanList.innerHTML += "<p>Tiada aduan ditemui.</p>";
        }
        snapshot.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "aduan-item";
          div.innerHTML = `
            <p><strong>Aduan:</strong> ${data.aduan}</p>
            <p class="status">Status: ${data.status}</p>
            ${data.nota ? `<p class="nota">Nota Admin: ${data.nota}</p>` : ""}
            <small>Tarikh: ${data.tarikh.toDate().toLocaleString()}</small>
          `;
          aduanList.appendChild(div);
        });
      });
    }

    // Bila pelajar isi nama + kelas → terus papar aduan dia
    document.getElementById("kelas").addEventListener("blur", () => {
      const nama = document.getElementById("nama").value.trim();
      const kelas = document.getElementById("kelas").value.trim();
      if (nama && kelas) {
        loadAduanPelajar(nama, kelas);
      }
    });
  </script>
</body>
</html>
