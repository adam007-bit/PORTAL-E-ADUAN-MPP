<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Portal Pelajar - Aduan SEMSIRA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-5">
  <h2 class="text-center mb-4">üéì Portal Pelajar Aduan SEMSIRA</h2>

  <!-- Borang Aduan -->
  <form id="aduanForm" class="card p-3 mb-4">
    <div class="mb-3">
      <label class="form-label">Nama</label>
      <input type="text" id="nama" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Kelas</label>
      <input type="text" id="kelas" class="form-control" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Aduan</label>
      <textarea id="aduan" class="form-control" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Hantar Aduan</button>
    <button type="button" class="btn btn-success" onclick="semakAduan()">Semak Aduan</button>
  </form>

  <!-- Senarai Aduan -->
  <div id="senaraiAduan"></div>
</div>

<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCkStR_IPVoyw83P9M3Xm0QayvNmHwsjz0",
    authDomain: "aduan-semsira.firebaseapp.com",
    projectId: "aduan-semsira",
    storageBucket: "aduan-semsira.appspot.com",
    messagingSenderId: "900897970331",
    appId: "1:900897970331:web:5bea8305599c97a0e30e3e"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Hantar aduan
  document.getElementById("aduanForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const nama = document.getElementById("nama").value.trim();
    const kelas = document.getElementById("kelas").value.trim();
    const aduan = document.getElementById("aduan").value.trim();

    if (!nama || !kelas || !aduan) {
      alert("‚ùå Sila isi semua maklumat sebelum hantar.");
      return;
    }

    await addDoc(collection(db, "aduan"), {
      nama,
      kelas,
      aduan,
      status: "Dalam Proses",
      nota: "",
      tarikh: new Date()
    });

    alert("‚úÖ Aduan anda telah dihantar!");
    document.getElementById("aduanForm").reset();
  });

  // Semak aduan ikut nama + kelas
  window.semakAduan = async function () {
    const nama = document.getElementById("nama").value.trim();
    const kelas = document.getElementById("kelas").value.trim();

    if (!nama || !kelas) {
      alert("Sila isi Nama dan Kelas dahulu untuk semak aduan.");
      return;
    }

    const q = query(
      collection(db, "aduan"),
      where("nama", "==", nama),
      where("kelas", "==", kelas)
    );

    const querySnapshot = await getDocs(q);
    const senaraiDiv = document.getElementById("senaraiAduan");
    senaraiDiv.innerHTML = "";

    if (querySnapshot.empty) {
      senaraiDiv.innerHTML = "<p class='text-danger'>‚ùå Tiada aduan ditemui.</p>";
      return;
    }

    querySnapshot.forEach(docSnap => {
      const data = docSnap.data();
      senaraiDiv.innerHTML += `
        <div class="card p-2 mb-2">
          <p><strong>Aduan:</strong> ${data.aduan}</p>
          <p><strong>Status:</strong> ${data.status}</p>
          <p><strong>Nota:</strong> ${data.nota || "-"}</p>
          <p><small><strong>Tarikh:</strong> ${data.tarikh?.toDate ? data.tarikh.toDate().toLocaleString() : data.tarikh}</small></p>
        </div>`;
    });
  }
</script>
</body>
</html>

